<!DOCTYPE html>
<html lang="ko" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/web/mainLayout}">

<th:block layout:fragment="content">
	<th:block th:replace="@{layout/web/mainLoadingBar.html} :: loadingBar"></th:block>

	<div id="wrapper">
		<th:block th:replace="@{layout/web/mainHeader.html} :: header"></th:block>
		<th:block th:replace="@{layout/web/mainLeftSidebar.html} :: sidebar"></th:block>
		<th:block th:replace="@{layout/web/contentDataTable.html} :: dataTable"></th:block>

		<div class="content-wrapper">
			<div class="container-fluid">
				<th:block th:replace="@{layout/web/contentHeader.html} :: contentHeader('화면 메뉴코드 관리','시스템 관리','화면 메뉴코드 관리','','')"></th:block>

				<div class="row">
					<div class="col-lg-12">
						<div class="card">
							<div class="card-header">
								<i class="fa fa-table"></i> 화면 메뉴코드
							</div>
							<div class="card-body">
								<div class="table-responsive">
									<table id="storeGrid" class="table table-bordered display">

									</table>
								</div>
							</div>
						</div>
					</div>
				</div>

			</div>
		</div>

		<div class="modal fade" id="post_store">
			<div class="modal-dialog">
				<div class="modal-content settingmated slideInUp">
					<div class="modal-header">
						<h5 class="modal-title"></h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<form id="post_storeForm">
						<div class="modal-body">
							<div class="form-group">
								<label for="post_cdMenu">화면 메뉴코드</label>
								<input type="text" class="form-control" id="post_cdMenu" name="cdMenu">
							</div>

							<div class="form-group">
								<label for="post_cdDesc">화면 메뉴명</label>
								<input type="text" class="form-control" id="post_cdDesc" name="cdDesc">
							</div>

							<div class="form-group">
								<label for="post_menuDesc">화면 메뉴 설명</label>
								<textarea rows="4" class="form-control" id="post_menuDesc" name="menuDesc"></textarea>
							</div>
						</div>
						<div class="modal-footer">
							<button type="submit" class="btn btn-success" onclick="store.post()"><i class="fa fa-check-square-o"></i>Save</button>
						</div>
					</form>
				</div>
			</div>
		</div>

		<div class="modal fade" id="put_store">
			<div class="modal-dialog">
				<div class="modal-content settingmated slideInUp">
					<div class="modal-header">
						<h5 class="modal-title"></h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<form id="put_storeForm">
						<div class="modal-body">
							<div class="form-group">
								<label for="put_cdMenu">화면 메뉴코드</label>
								<input type="text" class="form-control" id="put_cdMenu" name="cdMenu" readonly>
							</div>

							<div class="form-group">
								<label for="put_cdDesc">화면 메뉴명</label>
								<input type="text" class="form-control" id="put_cdDesc" name="cdDesc">
							</div>

							<div class="form-group">
								<label for="put_menuDesc">화면 메뉴 설명</label>
								<textarea rows="4" class="form-control" id="put_menuDesc" name="menuDesc"></textarea>
							</div>
						</div>
						<div class="modal-footer">
							<button type="submit" class="btn btn-success" onclick="store.put()"><i class="fa fa-check-square-o"></i>Save</button>
						</div>
					</form>
				</div>
			</div>
		</div>

		<th:block th:replace="@{layout/web/mainFooter.html} :: footer"></th:block>
		<th:block th:replace="@{layout/web/mainRightSidebar.html} :: sidebar"></th:block>
	</div>
</th:block>

<th:block layout:fragment="customScript">
	<script th:inline="javascript" type="text/javascript">
		$(document).ready(function () {
			store.initGrid();
			store.getGridData();

			$("#post_storeForm").validate({
				rules: {
					cdMenu: {
						required: true,
						minlength: 3
					},
					cdDesc: {
						required: true
					},
					menuDesc: {
						required: true
					}
				},
				message: {
					storeTel: {
						required: "cdMenu is required.",
						minlength: "cdMenu min length is 3."
					},
					cdDesc: {
						required: "cdDesc is required."
					},
					menuDesc: {
						required: "menuDesc is required."
					},
				},
			});

			$("#put_storeForm").validate({
				rules: {
					cdMenu: {
						required: true,
						minlength: 3
					},
					cdDesc: {
						required: true
					},
					menuDesc: {
						required: true
					}
				},
				message: {
					storeTel: {
						required: "cdMenu is required.",
						minlength: "cdMenu min length is 3."
					},
					cdDesc: {
						required: "cdDesc is required."
					},
					menuDesc: {
						required: "menuDesc is required."
					},
				},
			});
		});

		var store = {
			gridId: "storeGrid",
			gridTarget: function () {
				return $("#" + store.gridId).DataTable();
			},
			initGrid: function () {
				$("#"+store.gridId).DataTable({
					dom: 'Bftrip',
					columns: [
						{title: 'Store name', 			data: 'name', 			width: "20%"},
						{title: 'Telephone Number', 	data: 'telNumber', 		width: "30%"},
						{title: 'Information', 			data: 'info', 			width: "40%"},
					],
					data: [],
					select: {
						style: 'multi',
					},
					buttons: [
						{
							text: '<i class="fa fa-check-square"></i>',
							action: function () {
								var _selectedRows = store.gridTarget().rows({selected: true}).data().toArray();
								if(_selectedRows.length > 0) store.gridTarget().rows().deselect();
								else store.gridTarget().rows().select();
							}
						},
						{
							text: '<i class="fa fa-plus"></i>',
							action: function () {
								$("#post_store").modal("show");
							},
						},
						{
							text: '<i class="fa fa-edit"></i>',
							action: function () {
								var _selectedRows = store.gridTarget().rows({selected: true}).data().toArray();
								if(_selectedRows.length < 1) {
									lozm.func.alertRowIsSelected();
									return;
								} else if(_selectedRows.length > 1) {
									lozm.func.alertRowsAreSelected();
									return;
								}

								lozm.func.setDetail("put_", _selectedRows[0]);
								$("#put_store").modal("show");
							},
						},
						{
							text: '<i class="fa fa-minus"></i>',
							action: function () {
								var _selectedRows = store.gridTarget().rows({selected: true}).data().toArray();
								if(_selectedRows.length < 1) {
									lozm.func.alertRowIsSelected();
									return;
								}
								if(confirm("Are you sure to delete the data?")) store.delete(_selectedRows);
							},
						},
						{
							extend: "csv",
							text: '<i class="fa fa-download"></i>',
							charset: 'UTF-16LE',
						},
						{
							extend: "excel",
							text: '<i class="fa fa-file-excel-o"></i>',
							charset: 'UTF-16LE',
						}
					],
				});
			},
			getGridData: function () {
				lozm.func.requestGet({
					url: /*[[ @{/api/store} ]]*/ "",
					callback: {
						success: function (result) {
							if(result.success) {
								store.gridTarget().clear().draw();
								store.gridTarget().rows.add(result.data.list).draw();
							}
						},
						error: function (xhr, status, error) {
							console.log(xhr);
							console.log(status);
							console.log(error);
						}
					}
				});
			},
			post: function () {
				lozm.func.requestPost({
					url: /*[[ @{/api/store} ]]*/ "",
					data: {
						cdMenu: $("#post_cdMenu").val(),
						cdDesc: $("#post_cdDesc").val(),
						menuDesc: $("#post_menuDesc").val()
					},
					callback: {
						success: function (result) {
							if(result.success) {
								lozm.func.alertSuccess();
								store.getGridData();
							} else {
								lozm.func.alertFail();
							}
						},
						error: function (xhr, status, error) {
							console.log(xhr);
							console.log(status);
							console.log(error);
						}
					}
				});
			},
			put: function () {
				lozm.func.requestPut({
					url: /*[[ @{/api/store} ]]*/ "",
					data: {
						cdMenu: $("#put_cdMenu").val(),
						cdDesc: $("#put_cdDesc").val(),
						menuDesc: $("#put_menuDesc").val()
					},
					callback: {
						success: function (result) {
							if(result.success) {
								lozm.func.alertSuccess();
								store.getGridData();
							} else {
								lozm.func.alertFail();
							}
						},
						error: function (xhr, status, error) {
							console.log(xhr);
							console.log(status);
							console.log(error);
						}
					}
				});
			},
			delete: function (idList) {
				lozm.func.requestDelete({
					url: /*[[ @{/api/store} ]]*/ "",
					data: {
						storeList: idList
					},
					callback: {
						success: function (result) {
							if(result.success) {
								lozm.func.alertSuccess();
								store.getGridData();
							} else {
								lozm.func.alertFail();
							}
						},
						error: function (xhr, status, error) {
							console.log(xhr);
							console.log(status);
							console.log(error);
						}
					}
				});
			},
		};
	</script>
</th:block>
</html>
