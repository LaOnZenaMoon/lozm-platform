<th:block th:fragment="chatting()" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

    <script th:src="@{/libs/inspinia/js/socket/sockjs.min.js}"></script>
    <script th:src="@{/libs/inspinia/js/socket/stomp.min.js}"></script>

    <script type="text/javascript">
        var chatting = {
            stomp: null,
            displayArea: null,
            topic: null,
            connect: function (_displayArea, _topic) {
                chatting.stomp = Stomp.over(new SockJS("http://127.0.0.1:8888/lozm-chat"));
                chatting.stomp.connect({}, function (_frame) {
                    chatting.setConnected(_displayArea, _topic);
                    chatting.stomp.subscribe('/topic/' + chatting.topic, function (_chat) {
                        chatting.displayMessage(JSON.parse(_chat.body));
                    });
                });
            },
            disconnect: function (_displayArea) {
                chatting.sendMessage();
                if (chatting.stomp !== null) {
                    chatting.stomp.disconnect();
                }
                chatting.setConnected(_displayArea);
            },
            displayMessage: function (_result) {
                $(chatting.displayArea).append(
                    "<li>" +
                    "  <div class='dropdown-messages-box'>" +
                    "    <a class='dropdown-item float-left'>" +
                    "      <img class='rounded-circle' th:src='@{/images/agent.png}'/>" +
                    "    </a>" +
                    "    <div class='media-body'>" +
                    "      <div class='media-body'>" +
                    "        <small class='float-right text-navy'>"+_result.sendDateTime+"</small>" +
                    "        <strong>"+_result.writer+"</strong><br>" +
                    "        <small class='text-muted'>"+_result.message+"</small>" +
                    "      </div>" +
                    "    </div>" +
                    "  </div>" +
                    "</li>" +
                    "<li class='dropdown-divider'></li>"
                );
            },
            setConnected: function (_displayArea, _topic) {
                $(_displayArea).html("");
                chatting.displayArea = _displayArea;
                chatting.topic = _topic;
            },
            sendMessage: function (_writer, _messageArea) {
                chatting.stomp.send('/publish/chat/message'
                    , {}
                    , JSON.stringify({
                        topic: chatting.topic
                        , writer: _writer
                        , message: $(_messageArea).val()
                    })
                );

                $(_messageArea).val("");
            },
        };

        // $(document).ready(function() {
        //     $("form").on('submit', function (e) {
        //         e.preventDefault();
        //     });
        // });
    </script>

</th:block>