<!DOCTYPE html>
<html lang="ko" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/mainLayout}">

<th:block layout:fragment="content">
    <th:block th:replace="@{layout/mainLoadingBar.html} :: loadingBar"></th:block>

    <div id="wrapper">
        <th:block th:replace="@{layout/mainLeftSidebar.html} :: sidebar"></th:block>
        <th:block th:replace="@{layout/mainHeader.html} :: header"></th:block>
        <th:block th:replace="@{layout/contentDataTable.html} :: dataTable"></th:block>

        <div class="clearfix"></div>

        <div class="content-wrapper">
            <div class="container-fluid">

                <th:block
                        th:replace="@{layout/contentHeader.html} :: contentHeader('아이템 관리','아이템','','','')"></th:block>

                <div class="row">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-header">
                                <i class="fa fa-table"></i> Item > Shoes
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table id="default-datatable" class="table table-bordered display"></table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="overlay toggle-menu"></div>
            </div>

        </div>

        <div class="modal fade" id="post_shoes">
            <div class="modal-dialog">
                <div class="modal-content animated slideInUp">
                    <div class="modal-header">
                        <h5 class="modal-title">post</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <form id="post_shoesForm">
                        <div class="modal-body">
                            <div class="form-group">
                                <label for="post_shoes_name">name</label>
                                <input type="text" class="form-control" id="post_shoes_name" name="post_shoes_name">
                            </div>

                            <div class="form-group">
                                <label for="post_shoes_price">price</label>
                                <input type="text" class="form-control" id="post_shoes_price" name="post_shoes_price">
                            </div>

                            <div class="form-group">
                                <label for="post_shoes_size">size</label>
                                <input type="text" class="form-control" id="post_shoes_size" name="post_shoes_size">
                            </div>

                            <div class="form-group">
                                <label for="post_shoes_quantity">quantity</label>
                                <input type="text" class="form-control" id="post_shoes_quantity" name="post_shoes_quantity">
                            </div>

                            <div class="form-group">
                                <label for="post_shoes_contents">contents</label>
                                <textarea rows="4" class="form-control" id="post_shoes_contents" name="post_shoes_contents"></textarea>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-success" onclick="item.post()"><i class="fa fa-check-square-o"></i>Save</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="modal fade" id="put_shoes">
            <div class="modal-dialog">
                <div class="modal-content animated slideInUp">
                    <div class="modal-header">
                        <h5 class="modal-title">put</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <form id="put_shoesForm">
                        <div class="modal-body">
                            <div class="form-group">
                                <input type="hidden" class="form-control" id="put_shoes_id">
                            </div>

                            <div class="form-group">
                                <label for="put_shoes_name">name</label>
                                <input type="text" class="form-control" id="put_shoes_name" name="put_shoes_name">
                            </div>

                            <div class="form-group">
                                <label for="put_shoes_price">price</label>
                                <input type="text" class="form-control" id="put_shoes_price" name="put_shoes_price">
                            </div>

                            <div class="form-group">
                                <label for="post_shoes_size">size</label>
                                <input type="text" class="form-control" id="put_shoes_size" name="post_shoes_size">
                            </div>

                            <div class="form-group">
                                <label for="put_shoes_quantity">quantity</label>
                                <input type="text" class="form-control" id="put_shoes_quantity" name="put_shoes_quantity">
                            </div>

                            <div class="form-group">
                                <label for="put_shoes_contents">contents</label>
                                <textarea rows="4" class="form-control" id="put_shoes_contents" name="put_shoes_contents"></textarea>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-success" onclick="item.put()"><i class="fa fa-check-square-o"></i>Save</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <a href="javaScript:void();" class="back-to-top"><i class="fa fa-angle-double-up"></i> </a>

        <th:block th:replace="@{layout/mainFooter.html} :: footer"></th:block>
        <th:block th:replace="@{layout/mainRightSidebar.html} :: sidebar"></th:block>
    </div>
</th:block>

<th:block layout:fragment="customScript">
    <script th:inline="javascript" type="text/javascript">
        $(document).ready(function () {
            item.initGrid();
            item.getGridData();

            $("#post_shoesForm").validate({
                rules: {
                    itemTel: {
                        required: true,
                        minlength: 3
                    },
                    bigo: {
                        required: true
                    }
                },
                message: {
                    itemTel: {
                        required: "itemTel is required.",
                        minlength: "itemTel min length is 3."
                    },
                    bigo: {
                        required: "Bigo is required."
                    },
                },
            });

            $("#put_itemForm").validate({
                rules: {
                    itemTel: {
                        required: true,
                        minlength: 3
                    },
                    bigo: {
                        required: true
                    }
                },
                message: {
                    itemTel: {
                        required: "itemTel is required.",
                        minlength: "itemTel min length is 3."
                    },
                    bigo: {
                        required: "Bigo is required."
                    },
                },
            });
        });


        //TODO
        //1. 엑셀, csv 다운로드 버튼 붙이기.
        //2. CRUD 기능 만들기.
        var item = {
            gridId: "default-datatable",
            gridTarget: function () {
                return $("#" + item.gridId).DataTable();
            },
            initGrid: function () {
                $("#"+item.gridId).DataTable({
                    dom: 'Bftrip',
                    // ajax: "/api/item/clothing/SHOES",
                    columns: [
                        {title: 'id',       data: 'id',         visible: false},
                        {title: 'name',     data: 'name',       width: "30%"},
                        {title: 'contents', data: 'contents',   width: "40%"},
                        {title: 'price',    data: 'price',      width: "10%"},
                        {title: 'size',    data: 'size',      width: "10%"},
                        {title: 'quantity', data: 'quantity',   width: "10%"},
                    ],
                    data: [],
                    select: {
                        style: 'multi',
                    },
                    buttons: [
                        {
                            text: '<i class="fa fa-check-square"></i>',
                            action: function () {
                                var _selectedRows = item.gridTarget().rows({selected: true}).data().toArray();
                                if(_selectedRows.length > 0) item.gridTarget().rows().deselect();
                                else item.gridTarget().rows().select();
                            }
                        },
                        {
                            text: '<i class="fa fa-plus"></i>',
                            action: function () {
                                $("#post_shoes").modal("show");
                            },
                        },
                        {
                            text: '<i class="fa fa-edit"></i>',
                            action: function () {
                                var _selectedRows = item.gridTarget().rows({selected: true}).data().toArray();
                                if(_selectedRows.length < 1) {
                                    alert("At least select one row.");
                                    return;
                                } else if(_selectedRows.length > 1) {
                                    alert("Cannot select more then one row.");
                                    return;
                                }

                                console.log(_selectedRows);
                                lozm.func.setDetail("put_shoes_", _selectedRows[0]);
                                $("#put_shoes").modal("show");
                            },
                        },
                        {
                            text: '<i class="fa fa-minus"></i>',
                            action: function () {
                                var _selectedRows = item.gridTarget().rows({selected: true}).data().toArray();
                                if(_selectedRows.length < 1) {
                                    alert("At least select one row.");
                                    return;
                                }
                                if(confirm("Are you sure to delete the data?")) console.log("Deleted.");
                            },
                        },
                        {
                            extend: "csv",
                            text: '<i class="fa fa-download"></i>',
                            charset: 'UTF-16LE',
                        },
                        {
                            extend: "excel",
                            text: '<i class="fa fa-file-excel-o"></i>',
                            charset: 'UTF-16LE',
                        }
                    ],
                });
            },
            getGridData: function (itemType) {
                lozm.func.requestGet({
                    url: "/api/item/clothing/SHOES",
                    callback: {
                        success: function(resData) {
                            console.log(resData);
                            if(resData.success === true) {
                                item.gridTarget().clear().draw();
                                item.gridTarget().rows.add(resData.data).draw();
                            }
                        },
                        error: function(xhr, status, error) {
                            console.log(xhr);
                            console.log(status);
                            console.log(error);
                        }
                    }
                });
            },
            post: function () {
                lozm.func.requestPost({
                    url: "/api/item",
                    data: {
                        name: $("#post_shoes_name").val(),
                        price: $("#post_shoes_price").val(),
                        quantity: $("#post_shoes_quantity").val(),
                        contents: $("#post_shoes_contents").val(),
                        size: $("#post_shoes_size").val()
                    },
                    callback: {
                        success: function (result) {
                            console.log(result);
                            item.getGridData();
                            $("#post_shoesForm input textarea").clear();
                        },
                        error: function (xhr, status, error) {
                            console.log(xhr);
                            console.log(status);
                            console.log(error);
                        }
                    }
                });
            },
            put: function () {
                lozm.func.requestPut({
                    url: "/api/item",
                    data: {
                        id: $("#put_shoes_id").val(),
                        name: $("#put_shoes_name").val(),
                        price: $("#put_shoes_price").val(),
                        quantity: $("#put_shoes_quantity").val(),
                        contents: $("#put_shoes_contents").val(),
                        size: $("#put_shoes_size").val()
                    },
                    callback: {
                        success: function (result) {
                            console.log(result);
                            item.getGridData();
                            $("#put_shoesForm input textarea").clear();
                        },
                        error: function (xhr, status, error) {
                            console.log(xhr);
                            console.log(status);
                            console.log(error);
                        }
                    }
                });
            },
        };
    </script>
</th:block>